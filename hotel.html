<!DOCTYPE html>
<html lang="it">

<head>
    <!-- Impostazioni di base del documento -->
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Hotel Minichino - Prenotazione Online</title>

    <!-- Bootstrap per la gestione del layout e degli stili -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">

    <!-- jQuery per la gestione degli eventi e delle richieste asincrone -->
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>

    <!-- Stili personalizzati per migliorare il layout -->
    <style>
        body {
            background-color: #f0f4f8;
            color: #333;
        }

        /* Stile per le card (contenitori) delle informazioni di prenotazione */
        .card {
            border-radius: 10px;
            margin-bottom: 20px;
            width: 100%;
            max-width: 600px;
            margin-left: auto;
            margin-right: auto;
            background-color: #ffffff;
        }

        .card-header {
            font-size: 1.25rem;
            padding: 15px;
            background-color: #007bff;
            color: white;
        }

        .card-body {
            padding: 20px;
        }

        /* Aggiungi un margine superiore alla container principale */
        .container {
            margin-top: 50px;
        }

        /* Stile per i pulsanti */
        .btn {
            padding: 12px;
            font-size: 1.1rem;
        }

        /* Centra i form all'interno delle card */
        form {
            margin-top: 15px;
        }

        /* Stile per gli alert */
        .alert {
            margin-top: 20px;
        }

        /* Adatta il layout per schermi piccoli */
        @media (max-width: 768px) {
            .card {
                max-width: 100%;
                margin-bottom: 10px;
            }
        }

        /* Stile per l'intestazione dell'hotel */
        .hotel-header {
            text-align: center;
            margin-bottom: 30px;
        }

        .hotel-header img {
            max-width: 150px;
            border-radius: 50%;
            margin-bottom: 20px;
        }

        .hotel-header h1 {
            font-size: 2.5rem;
            color: #333;
        }

        .hotel-header p {
            font-size: 1.1rem;
            color: #555;
        }

        /* Stile per la sezione di contatto */
        .contact-section {
            background-color: #f0f4f8;
            padding: 30px;
            text-align: center;
            margin-top: 50px;
            border-top: 1px solid #ddd;
        }

        .contact-section p {
            font-size: 1.1rem;
            color: #333;
        }

        .contact-section .email {
            font-size: 1.2rem;
            font-weight: bold;
            color: #007bff;
        }

        .contact-section .city {
            font-size: 1.1rem;
            color: #555;
        }

        /* Stile per la sezione privacy */
        .privacy-section {
            background-color: #f0f4f8;
            padding: 20px;
            text-align: center;
            margin-top: 30px;
            border-top: 1px solid #ddd;
        }

        .privacy-section h5 {
            margin-bottom: 15px;
        }
    </style>
</head>

<body>
    <div class="container mt-5">
        <!-- Intestazione con Logo e Nome dell'Hotel -->
        <header class="hotel-header">
            <h1>Hotel Minichino</h1>
            <p>Un rifugio di comfort e lusso nel cuore della città. Prenota la tua stanza per un'esperienza indimenticabile!</p>
        </header>

        <div class="row justify-content-center">
            <div class="col-lg-8 col-md-10 col-sm-12">
                <!-- Sezione Prenotazione Stanza -->
                <div class="card shadow">
                    <div class="card-header text-center">
                        <h4>Prenota una Stanza</h4>
                    </div>
                    <div class="card-body">
                        <form id="prenotazioneForm">
                            <!-- Campo per il nome e cognome del cliente -->
                            <div class="mb-3">
                                <label for="nome_cliente" class="form-label">Nome e Cognome</label>
                                <input
                                    type="text"
                                    class="form-control"
                                    id="nome_cliente"
                                    placeholder="Inserisci il tuo nome e cognome"
                                    required
                                >
                            </div>

                            <!-- Campo per l'email del cliente -->
                            <div class="mb-3">
                                <label for="email_cliente" class="form-label">Email</label>
                                <input
                                    type="email"
                                    class="form-control"
                                    id="email_cliente"
                                    placeholder="Inserisci la tua email"
                                    required
                                >
                            </div>

                            <!-- Selezione del tipo di stanza -->
                            <div class="mb-3">
                                <label for="stanza_id" class="form-label">Tipo di Stanza</label>
                                <select
                                    class="form-select"
                                    id="stanza_id"
                                    required
                                >
                                    <option value="">Seleziona il tipo di stanza</option>
                                    <option value="0">Singola</option>
                                    <option value="1">Doppia</option>
                                    <option value="2">Tripla</option>
                                    <option value="3">Quadrupla</option>
                                    <option value="4">Suite</option>
                                </select>
                            </div>

                            <!-- Selezione della data di check-in -->
                            <div class="mb-3">
                                <label for="data_checkin" class="form-label">Data Check-in</label>
                                <input
                                    type="date"
                                    class="form-control"
                                    id="data_checkin"
                                    required
                                >
                            </div>

                            <!-- Selezione della data di check-out -->
                            <div class="mb-3">
                                <label for="data_checkout" class="form-label">Data Check-out</label>
                                <input
                                    type="date"
                                    class="form-control"
                                    id="data_checkout"
                                    required
                                >
                            </div>

                            <!-- Checkbox per il consenso al trattamento dei dati personali -->
                            <div class="mb-3 form-check">
                                <input type="checkbox" class="form-check-input" id="consenso" required>
                                <label class="form-check-label" for="consenso">
                                    Accetto il trattamento dei dati personali e la <a href="privacy_policy.html" target="_blank">privacy policy</a>.
                                </label>
                            </div>

                            <!-- Bottone per inviare il modulo -->
                            <div class="text-center">
                                <button type="submit" class="btn btn-primary w-100">Prenota</button>
                            </div>
                        </form>

                        <!-- Area per gli alert di errore o successo -->
                        <div id="alert-container"></div>
                    </div>
                </div>

                <!-- Sezione per la cancellazione della prenotazione -->
                <div class="card shadow">
                    <div class="card-header text-center bg-danger text-white">
                        <h4>Cancella Prenotazione</h4>
                    </div>
                    <div class="card-body">
                        <form id="cancellazioneForm">
                            <!-- Campo per l'email del cliente da cancellare -->
                            <div class="mb-3">
                                <label for="email_cancellazione" class="form-label">Email</label>
                                <input
                                    type="email"
                                    class="form-control"
                                    id="email_cancellazione"
                                    placeholder="Inserisci la tua email"
                                    required
                                >
                            </div>

                            <!-- Bottone per inviare il modulo di cancellazione -->
                            <div class="text-center">
                                <button type="submit" class="btn btn-danger btn-sm">Cancella</button>
                            </div>
                        </form>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Sezione Contatti -->
    <div class="contact-section">
        <p>Per qualsiasi informazione, non esitare a contattarci:</p>
        <p class="email">info@hotelminichino.it</p>
        <p class="city">Vicoletto Napoli 1, 80143 Napoli (NA)</p>
    </div>

    <!-- Sezione Privacy -->
    <div class="privacy-section">
        <h5>Trattamento dei Dati Personali e Privacy</h5>
        <p>Informiamo i nostri clienti che i dati personali forniti durante la prenotazione saranno trattati nel rispetto della normativa vigente sulla privacy.</p>
    </div>

    <!-- Script per Bootstrap -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    
    <!-- Gestione della logica di invio del modulo di prenotazione -->
    <script>
        // Gestione del submit del modulo di prenotazione
        $("#prenotazioneForm").on("submit", function(e) {
            e.preventDefault();

            // Recupero dei dati dal modulo di prenotazione
            const consenso = $("#consenso").is(":checked");

            if (!consenso) {
                mostraAlert("danger", "Devi accettare il trattamento dei dati personali per procedere.");
                return;
            }

            const prenotazione = {
                nome_cliente: $("#nome_cliente").val(),
                email_cliente: $("#email_cliente").val(),
                stanza_id: parseInt($("#stanza_id").val()),
                data_checkin: $("#data_checkin").val(),
                data_checkout: $("#data_checkout").val()
            };

            // Verifica se è stato selezionato un tipo di stanza valido
            if (isNaN(prenotazione.stanza_id)) {
                mostraAlert("danger", "Seleziona un tipo di stanza valido.");
                return;
            }

            // Chiamata AJAX per inviare i dati al server
            $.ajax({
                url: "http://127.0.0.1:5000/prenota",
                type: "POST",
                contentType: "application/json",
                data: JSON.stringify(prenotazione),
                success: function(response) {
                    mostraAlert("success", response.message);
                    $("#prenotazioneForm")[0].reset();  // Reset del modulo
                },
                error: function(xhr) {
                    mostraAlert("danger", xhr.responseJSON.message || "Errore durante la prenotazione.");
                }
            });
        });

        // Gestione della cancellazione della prenotazione
        $("#cancellazioneForm").on("submit", function(e) {
            e.preventDefault();

            const email = $("#email_cancellazione").val();

            $.ajax({
                url: "http://127.0.0.1:5000/cancella",
                type: "POST",
                contentType: "application/json",
                data: JSON.stringify({ email }),
                success: function(response) {
                    mostraAlert("success", response.message);
                    $("#cancellazioneForm")[0].reset();
                },
                error: function(xhr) {
                    mostraAlert("danger", xhr.responseJSON.message || "Errore durante la cancellazione.");
                }
            });
        });

        // Funzione per mostrare un alert con messaggio
        function mostraAlert(tipo, messaggio) {
            const alertHTML = `
                <div class="alert alert-${tipo} alert-dismissible fade show" role="alert">
                    ${messaggio}
                    <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
                </div>
            `;
            
            // Aggiungi l'alert al contenitore
            $("#alert-container").append(alertHTML);
            
            // Rimuovi l'alert dopo 4 secondi
            setTimeout(function() {
                $(".alert").last().alert('close');
            }, 4000);
        }
    </script>
</body>

</html>
